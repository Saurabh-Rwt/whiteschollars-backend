<div class="container">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Add  Course Intro</h5>
    </div>
    <div class="card-body">
      <!-- Course Dropdown -->
      {% include 'components/course_dropdown.html' %}

      {% if selected_course %}
      <form method="POST" enctype="multipart/form-data" action="{% url 'add_section' %}">
        {% csrf_token %}
        <input type="hidden" name="course" value="{{ selected_course.id }}">

        <!-- Logo -->
        <div class="mb-3">
          <label for="logo" class="form-label">Logo</label>
          <input type="file" class="form-control" id="logo" name="logo" accept="image/*" />
          <!-- Logo Preview -->
          <div id="mainLogoPreview" class="mt-2"></div>
        </div>

        <!-- Section Heading -->
        <div class="mb-3">
          <label for="sectionHeading" class="form-label">Section Heading</label>
          <input type="text" class="form-control" id="sectionHeading" name="section_heading"
            placeholder="Enter section heading" />
        </div>

        <!-- Text -->
        <div class="mb-3">
          <label for="text" class="form-label">Text</label>
          <textarea class="form-control" id="text" name="text" rows="3" placeholder="Enter section text"></textarea>
        </div>

        <!-- List Text -->
        <div class="mb-3">
          <label class="form-label">List Text</label>
          <div id="listTextContainer">
            <div class="input-group mb-2">
              <input type="text" class="form-control" name="list_text[]" placeholder="Enter list item" />
              <button type="button" class="btn btn-outline-success addListText">+</button>
            </div>
          </div>
        </div>

        <!-- Collaboration Logos -->
        <div class="mb-3">
          <label class="form-label">Collaboration Logos</label>
          <div class="d-flex align-items-center gap-2 mb-2">
            <input type="file" class="form-control" id="collabLogo" name="collaboration_logo[]" accept="image/*" multiple />
            <button type="button" class="btn btn-outline-primary" id="addCollabLogo">Add</button>
          </div>
          <div id="logoPreview" class="d-flex flex-wrap gap-2"></div>
        </div>

        <!-- YouTube Video Link -->
        <div class="mb-3">
          <label for="videoLink" class="form-label">Course YouTube Video Link</label>
          <input type="url" class="form-control" id="videoLink" name="youtube_video"
            placeholder="https://www.youtube.com/watch?v=example" />
        </div>

        <!-- Submit Button -->
        <div class="text-end">
          <button type="submit" class="btn btn-success px-4">Submit</button>
        </div>
      </form>
      {% endif %}
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    $(document).on('click', '.addListText', function () {
      const newField = `
        <div class="input-group mb-2">
          <input type="text" class="form-control" name="list_text[]" placeholder="Enter list item" />
          <button type="button" class="btn btn-outline-danger removeListText">âˆ’</button>
        </div>`;
      $('#listTextContainer').append(newField);
    });
    $(document).on('click', '.removeListText', function () {
      $(this).closest('.input-group').remove();
    });
    $('#logo').on('change', function () {
      const file = this.files[0];
      const preview = $('#mainLogoPreview');
      preview.empty();
      if (file) {
        const reader = new FileReader();
        reader.onload = function (event) {
          const logoContainer = $('<div>')
            .addClass('position-relative d-inline-block')
            .css({ width: '100px', height: '100px' });

          const img = $('<img>')
            .attr('src', event.target.result)
            .addClass('img-thumbnail')
            .css({
              width: '100px',
              height: '100px',
              objectFit: 'cover',
              borderRadius: '5px'
            });
          const removeBtn = $('<button>')
            .attr('type', 'button')
            .html('&times;')
            .addClass('btn btn-sm btn-danger position-absolute top-0 end-0 translate-middle rounded-circle removeMainLogoBtn')
            .css({
              width: '22px',
              height: '22px',
              padding: '0',
              lineHeight: '1',
              fontSize: '14px'
            });

          logoContainer.append(img).append(removeBtn);
          preview.append(logoContainer);
        };
        reader.readAsDataURL(file);
      }
    });
    $(document).on('click', '.removeMainLogoBtn', function () {
      $('#logo').val(''); // reset file input
      $('#mainLogoPreview').empty();
    });
    $('#addCollabLogo').on('click', function () {
      const fileInput = $('#collabLogo')[0];
      const files = fileInput.files;
      if (files.length === 0) return;
      const preview = $('#logoPreview');
      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function (event) {
          const logoContainer = $('<div>')
            .addClass('position-relative d-inline-block')
            .css({ width: '80px', height: '80px', margin: '5px' });

          const img = $('<img>')
            .attr('src', event.target.result)
            .addClass('img-thumbnail')
            .css({
              width: '80px',
              height: '80px',
              objectFit: 'cover',
              borderRadius: '5px'
            });

          const removeBtn = $('<button>')
            .attr('type', 'button')
            .html('&times;')
            .addClass('btn btn-sm btn-danger position-absolute top-0 end-0 translate-middle rounded-circle removeLogoBtn')
            .css({
              width: '20px',
              height: '20px',
              padding: '0',
              lineHeight: '1',
              fontSize: '14px'
            });
          const newInput = $('<input>')
            .attr('type', 'file')
            .attr('name', 'collaboration_logo[]')
            .prop('files', createFileList(file))
            .css('display', 'none');

          logoContainer.append(img).append(removeBtn).append(newInput);
          preview.append(logoContainer);
        };
        reader.readAsDataURL(file);
      });
      $('#collabLogo').val('');
    });
    $(document).on('click', '.removeLogoBtn', function () {
      $(this).closest('div.position-relative').remove();
    });
    function createFileList(file) {
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);
      return dataTransfer.files;
    }

  });
</script>