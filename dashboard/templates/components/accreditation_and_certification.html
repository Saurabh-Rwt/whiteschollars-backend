<div class="container" id="accreditation-panel">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Accreditations and Certifications</h5>
    </div>

    <div class="card-body">
      {% include 'components/course_dropdown.html' with dropdown_id='accreditation-course' %}

      {% if selected_course %}
      <div class="editor-grid">
        <div class="editor-card">
          <div class="editor-step">
            <div class="editor-step-number">2</div>
            <div>
              <div class="editor-step-title">Upload accreditation logos</div>
              <p class="editor-helper">You can select multiple logos at once.</p>
            </div>
          </div>

          <form method="POST" enctype="multipart/form-data" action="{% url 'add_accreditation_and_certification' %}" id="accreditation-form">
            {% csrf_token %}
            <input type="hidden" name="course" value="{{ selected_course.id }}" />

            <div class="mb-3">
              <label for="accreditation-files" class="form-label">Accreditation Logos</label>
              <input
                type="file"
                class="form-control"
                id="accreditation-files"
                name="certification_logo"
                accept="image/*"
                multiple
                required
              />
              <div id="accreditation-preview" class="preview-stack mt-2"></div>
            </div>

            <div class="text-end">
              <button type="submit" class="btn btn-success px-4">Save Logos</button>
            </div>
          </form>

          {% if accreditations %}
            <hr />
            <h6 class="mb-2">Saved Logos</h6>
            <div class="preview-stack">
              {% for entry in accreditations %}
                {% for logo in entry.certification_logo %}
                  <img src="{{ logo }}" alt="Accreditation logo" class="preview-image" />
                {% endfor %}
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <div class="preview-card" id="accreditation-preview-panel">
          <div class="preview-title">Live Preview</div>
          <div class="preview-muted mb-2">Accreditation logos will appear like a row of badges.</div>
          <div id="accreditation-preview-live" class="preview-stack">
            <span class="preview-empty">Selected logos will appear here.</span>
          </div>
        </div>
      </div>
      {% else %}
        <div class="editor-card">Select a course to add accreditation logos.</div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  (function () {
    const container = document.getElementById("accreditation-panel");
    if (!container) return;

    const fileInput = container.querySelector("#accreditation-files");
    const preview = container.querySelector("#accreditation-preview");
    const previewLive = container.querySelector("#accreditation-preview-live");

    if (!fileInput) return;

    const renderPreview = (files) => {
      preview.innerHTML = "";
      previewLive.innerHTML = "";

      if (!files || !files.length) {
        previewLive.innerHTML = "<span class='preview-empty'>Selected logos will appear here.</span>";
        return;
      }

      Array.from(files).forEach((file) => {
        const reader = new FileReader();
        reader.onload = (event) => {
          const img = document.createElement("img");
          img.src = event.target.result;
          img.alt = "Accreditation logo";
          img.className = "preview-image";
          preview.appendChild(img.cloneNode(true));
          previewLive.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    };

    fileInput.addEventListener("change", (event) => {
      renderPreview(event.target.files);
    });
  })();
</script>
