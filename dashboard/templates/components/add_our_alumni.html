<div class="container" id="our-alumni-panel">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Our Alumni</h5>
    </div>
    <div class="card-body">
      {% include 'components/course_dropdown.html' with dropdown_id='our-alumni-course' %}

      {% if selected_course %}
      <div class="editor-grid">
        <div class="editor-card">
          <div class="editor-step">
            <div class="editor-step-number">2</div>
            <div>
              <div class="editor-step-title">Upload alumni logos</div>
              <p class="editor-helper">Select multiple logos at once to display on the course page.</p>
            </div>
          </div>

          <form method="POST" enctype="multipart/form-data" action="{% url 'add_our_alumni' %}" id="our-alumni-form">
            {% csrf_token %}
            <input type="hidden" name="course" value="{{ selected_course.id }}" />

            <div class="mb-3">
              <label for="our-alumni-files" class="form-label">Alumni Logos</label>
              <input type="file" id="our-alumni-files" class="form-control" name="alumni_logo[]" accept="image/*" multiple required />
              <div id="our-alumni-preview" class="preview-stack mt-2"></div>
            </div>

            <div class="text-end">
              <button type="submit" class="btn btn-success px-4">Save Alumni Logos</button>
            </div>
          </form>

          {% if our_alumni_entries %}
            <hr />
            <h6 class="mb-2">Saved Logos</h6>
            <div class="preview-stack">
              {% for entry in our_alumni_entries %}
                {% for logo in entry.alumni_logo %}
                  <img src="/media/{{ logo }}" alt="Alumni logo" class="preview-image" />
                {% endfor %}
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <div class="preview-card" id="our-alumni-preview-panel">
          <div class="preview-title">Live Preview</div>
          <div id="our-alumni-preview-live" class="preview-stack">
            <span class="preview-empty">Selected alumni logos will appear here.</span>
          </div>
        </div>
      </div>
      {% else %}
        <div class="editor-card">Select a course to add alumni logos.</div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  (function () {
    const container = document.getElementById("our-alumni-panel");
    if (!container) return;

    const fileInput = container.querySelector("#our-alumni-files");
    const preview = container.querySelector("#our-alumni-preview");
    const previewLive = container.querySelector("#our-alumni-preview-live");

    if (!fileInput) return;

    const renderPreview = (files) => {
      preview.innerHTML = "";
      previewLive.innerHTML = "";

      if (!files || !files.length) {
        previewLive.innerHTML = "<span class='preview-empty'>Selected alumni logos will appear here.</span>";
        return;
      }

      Array.from(files).forEach((file) => {
        const reader = new FileReader();
        reader.onload = (event) => {
          const img = document.createElement("img");
          img.src = event.target.result;
          img.alt = "Alumni logo";
          img.className = "preview-image";
          preview.appendChild(img.cloneNode(true));
          previewLive.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    };

    fileInput.addEventListener("change", (event) => {
      renderPreview(event.target.files);
    });
  })();
</script>
